var DASHBOARD = (function(){

	var notice_list_page = 1;
	var notice_list_page_more = true;
	var activity_list_page = 1;
	var activity_list_page_more = true;
	var activity_list_cnt = 1;
	/*var re = /(?:(?=(?:http|https):)([a-zA-Z][-+.a-zA-Z\d]*):(?:((?:[-_.!~*'()a-zA-Z\d;?:@&=+$,]|%[a-fA-F\d]{2})(?:[-_.!~*'()a-zA-Z\d;\/?:@&=+$,\[\]]|%[a-fA-F\d]{2})*)|(?:(?:\/\/(?:(?:(?:((?:[-_.!~*'()a-zA-Z\d;:&=+$,]|%[a-fA-F\d]{2})*)@)?(?:((?:(?:(?:[a-zA-Z\d](?:[-a-zA-Z\d]*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:[-a-zA-Z\d]*[a-zA-Z\d])?)\.?|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\[(?:(?:[a-fA-F\d]{1,4}:)*(?:[a-fA-F\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-fA-F\d]{1,4}:)*[a-fA-F\d]{1,4})?::(?:(?:[a-fA-F\d]{1,4}:)*(?:[a-fA-F\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)\]))(?::(\d*))?))?|((?:[-_.!~*'()a-zA-Z\d$,;:@&=+]|%[a-fA-F\d]{2})+))|(?!\/\/))(\/(?:[-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*(?:;(?:[-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*)*(?:\/(?:[-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*(?:;(?:[-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*)*)*)?)(?:\?((?:[-_.!~*'()a-zA-Z\d;\/?:@&=+$,\[\]]|%[a-fA-F\d]{2})*))?)(?:\#((?:[-_.!~*'()a-zA-Z\d;\/?:@&=+$,\[\]]|%[a-fA-F\d]{2})*))?)/img;*/

	var getNoticeList = function(list_body_obj){
		if(notice_list_page_more){
			$.ajax({
				type : 'POST',
				data : {page : notice_list_page},
				url : ('/admin/ajax/support/get_notice_list.cm'),
				dataType : 'json',
				async : true,
				cache : false,
				success : function(obj){
					list_body_obj.append(obj.html);
					notice_list_page = obj.page;
					notice_list_page_more = obj.more == "Y";

					$('#notice_list').imagesLoaded()
						.always(function(ins){
							$('#notice_list').masonry({
								// options
								itemSelector : '.ma-item'
							});
						});

				}
			});
		}
	};

	var getActivityList = function(list_body_obj){
		if(activity_list_page_more){
			$.ajax({
				type : 'POST',
				data : {page : activity_list_page, cnt : activity_list_cnt},
				url : ('/admin/ajax/stat/get_activity_list.cm'),
				dataType : 'json',
				async : true,
				cache : false,
				success : function(obj){
					list_body_obj.append(obj.html);
					activity_list_page = obj.page;
					activity_list_page_more = obj.more == "Y";
					activity_list_cnt = obj.cnt;

					/**
					 * ë°ì´í„° ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
					 */
					if ( obj.html === "" && obj.cnt === 0 ) {
						$('.section-body').html(`
							<div class="feedback-nodata">
								<div>
									<div class="bar-wrap">
										<div></div>
										<div></div>
										<div></div>
										<div></div>
									</div>
				
									<div class="circle-wrap">
										<div></div>
										<div></div>
										<div></div>
									</div>
				
									<div class="card-wrap">
										<div>
											<div>
												<img src="/admin/img/stat/feedback_user_1.svg" alt="">
												<div>
													<p>[ëŒ“ê¸€] ë„ˆë¬´ ê¸°ë‹¤ë¦¬ê³  ìˆë˜ ìƒí’ˆì´ì—ìš”! ğŸ˜</p>
													<span>ê³ ê°ì˜ ì†Œë¦¬ 1ì‹œê°„ ì „</span>
												</div>
											</div>
											<svg xmlns="http://www.w3.org/2000/svg" width="6" height="12" viewBox="0 0 6 12" fill="none"><path d="M0.707107 6.70711C0.316583 6.31658 0.316583 5.68342 0.707107 5.29289L6 0L6 12L0.707107 6.70711Z" fill="white"/></svg>
										</div>
										<div>
											<div>
												<img src="/admin/img/stat/feedback_user_2.svg" alt="">
												<div>
													<p>[ì‘ì„±] ê¹€ì•„ì„ë‹˜ì´ ì…ë ¥í¼ ì°¸ì—¬ë¥¼ ì™„ë£Œ í–ˆì–´ìš”</p>
													<span>ì´ë²¤íŠ¸ 2ì‹œê°„ì „</span>
												</div>
											</div>
											<svg xmlns="http://www.w3.org/2000/svg" width="6" height="12" viewBox="0 0 6 12" fill="none"><path d="M0.707107 6.70711C0.316583 6.31658 0.316583 5.68342 0.707107 5.29289L6 0L6 12L0.707107 6.70711Z" fill="white"/></svg>
										</div>
										<div>
											<div>
												<img src="/admin/img/stat/feedback_user_3.svg" alt="">
												<div>
													<p>[ëŒ“ê¸€] ë¹ ë¥¸ ë°°ì†¡ ìµœê³ ì—ìš”</p>
													<span>ê³ ê°ì˜ ì†Œë¦¬ 3ì‹œê°„ ì „</span>
												</div>
											</div>
											<svg xmlns="http://www.w3.org/2000/svg" width="6" height="12" viewBox="0 0 6 12" fill="none"><path d="M0.707107 6.70711C0.316583 6.31658 0.316583 5.68342 0.707107 5.29289L6 0L6 12L0.707107 6.70711Z" fill="white"/></svg>
										</div>
									</div>
								</div>
				
								<p>ì•„ì§ ì»¨í…ì¸  ë°˜ì‘ì´ ì—†ì–´ìš”</p>
								<span>ê³ ê°ë¶„ë“¤ì˜ ì†Œë¦¬ê°€ ì‹œì‘ë˜ë©´<br/>íƒ€ì„ë¼ì¸ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆê²Œ ì•Œë ¤ë“œë¦´ê²Œìš”!</span>
							</div>
						`)
					}
				}
			});
		}
	};

	var dashboard_init = function(){
		$('#dashboard_list').imagesLoaded().always(function(ins) {
			$('#dashboard_list').masonry({ itemSelector: '.ma-item' });
		});

		var autolinker = new Autolinker({	//ìë™ìœ¼ë¡œ url ë§í¬ë¡œ ì „í™˜
			urls: {
				schemeMatches: true,
				wwwMatches: true,
				tldMatches: true
			},
			email: false,
			stripPrefix: false,
			newWindow: true,

			truncate: {
				length: 0,
				location: 'end'
			},
			className: ''
		});

		$('._memo_body').each(function (i, elem) {
			$(elem).html(autolinker.link($(elem).html()));
		});
		autosize(document.querySelectorAll('textarea'));
		// var owl = $('#DashboardBanner');
		//
		// owl.owlCarousel({
		// 	'items': 1,
		// 	'nav' : true,
		// 	'loop' : true,
		// 	'dots' : true
		// });
	};

	var updateIsDashboardFirstEnter = function(){
		$.ajax({
			type : 'POST',
			url : ('/admin/ajax/dashboard/update_is_dashboard_first_enter.cm'),
			dataType : 'json',
			async : false,
			cache : false,
			success : function(result){
				if(result.msg === "SUCCESS"){
					// location.reload();
				}else{
					alert(result.msg);
				}
			}
		});
	};

	var giveAdminPermission = function(){
		var confirm_msg = getLocalizeString("ì„¤ëª…_ë‹´ë‹¹ë¦¬ì…€ëŸ¬ì—ê²Œê´€ë¦¬ê¶Œí•œì„ë¶€ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ", "", "ë‹´ë‹¹ ë¦¬ì…€ëŸ¬ì—ê²Œ ê´€ë¦¬ê¶Œí•œì„ ë¶€ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê´€ë¦¬ê¶Œí•œì„ ë¶€ì—¬\ní•˜ê²Œ ë˜ë©´, ì‚¬ì´íŠ¸ì˜ ë””ìì¸ê³¼ ê°ì¢… ì„¤ì •ì„ ì œì–´í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ê¶Œí•œì´ ë¶€\nì—¬ë©ë‹ˆë‹¤.");
		if(confirm_msg !== undefined){
			if(confirm(confirm_msg)){
				$.ajax({
					type: 'POST',
					data: '',
					url: ('/admin/ajax/config/find_designer/give_admin_permission.cm'),
					dataType: 'json',
					async: false,
					cache: false,
					success: function (res) {
						if(res.msg === 'SUCCESS'){
							$('._custom_popover._dashboard_reseller_popover_before').hide();
							$('._custom_popover._dashboard_reseller_popover_before').popover('hide');

							$('._custom_popover._dashboard_reseller_popover_after').show();
							$('._custom_popover._dashboard_reseller_popover_after').popover('show');
						}else
							alert(res.msg);
					}
				});
			}
		}
	};

	var showUpdateMemoForm = function(memo_idx){
		$('#old_memo_'+memo_idx).hide();
		$('#update_memo_wrap_'+memo_idx).show();
		var height = $('#update_memo_wrap_'+memo_idx).find("#update_memo").prop('scrollHeight');
		$('#update_memo_wrap_'+memo_idx).find("#update_memo").css('height', height+5);
	};

	var hideUpdateMemoForm = function(memo_idx){
		$('#old_memo_'+memo_idx).show();
		$('#update_memo_wrap_'+memo_idx).hide();
		$('#update_memo_wrap_'+memo_idx).find('#update_memo').val($('#old_memo_'+memo_idx).text());
	};

	var updateHtml = function(callback) {
		$.ajax({
			type: 'GET',
			url : `/admin/ajax/dashboard/get_memo_list_html.cm?site_code=${SITE_CODE}`,
			dataType : 'html',
			success : function(html){
				$('.update_memo_list').html(html);

				callback?.();
			}
		})
	}

	var releaseTopMemo = function(memo_idx){
		$.ajax({
			type : 'POST',
			data : {memo_idx :memo_idx},
			url : ('/admin/ajax/dashboard/release_top_memo.cm'),
			dataType : 'json',
			async : false,
			cache : false,
			success : function(result){
				if(result.msg === "SUCCESS"){
					updateHtml();
				}else{
					alert(result.msg);
				}
			}
		});
	};
	var moveTopMemo = function(memo_idx){
		$.ajax({
			type : 'POST',
			data : {memo_idx :memo_idx},
			url : ('/admin/ajax/dashboard/move_top_memo.cm'),
			dataType : 'json',
			async : false,
			cache : false,
			success : function(result){
				if(result.msg === "SUCCESS"){
					updateHtml();
				}else{
					alert(result.msg);
				}
			}
		});
	};

	var deleteMemo = function(memo_idx){
		if(confirm(getLocalizeString("ì„¤ëª…_ì •ë§ë¡œì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ", "", "ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))){
			$.ajax({
				type : 'POST',
				data : {memo_idx :memo_idx},
				url : ('/admin/ajax/dashboard/delete_managers_memo.cm'),
				dataType : 'json',
				async : false,
				cache : false,
				success : function(result){
					if(result.msg === "SUCCESS"){
						updateHtml();
					}else{
						alert(result.msg);
					}
				}
			});
		}else
			return false;
	};

	var addMemo = function($obj){
		var data = $obj.serializeObject();
		if($obj.find('#memo').val() === ''){
			alert(getLocalizeString("ì„¤ëª…_ë‚´ìš©ì„ì…ë ¥í•´ì£¼ì„¸ìš”", "", "ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."));
			return;
		}
		$.ajax({
			type : 'POST',
			data : data,
			url : ('/admin/ajax/dashboard/add_managers_memo.cm'),
			dataType : 'json',
			async : false,
			cache : false,
			success : function(result){
				if(result.msg === "SUCCESS"){
					updateHtml(function () {
						if ( !data.memo_idx ) {
							$('#memo').val('');

							$.ajax({
								type: 'GET',
								url: `/admin/ajax/dashboard/get_new_memo_hash.cm`,
								dataType: 'json',
								success: function (data) {
									$('input[name="write_token_key"]').val(data.write_token_key)
									$('input[name="write_token"]').val(data.write_token)

								}
							})
						}

						mixpanel.track('save_bo_dashboard_memo',{'site_code':SITE_CODE});
					})
				}else{
					alert(result.msg);
				}
			}
		});
	};

	var openSiteManagementDialog = function(btn){
		if($.cocoaStickerModal.isOpen()){
			$.cocoaStickerModal.close();
		}
		if(document.querySelector('#use-shopping-tooltip')){
			document.querySelector('#use-shopping-tooltip').remove();
		}

		const isSidebarMini = $('body').hasClass('sidebar-mini');

		$.ajax({
			type: 'POST',
			url: ('/admin/ajax/dialog/site_management.cm'),
			dataType: 'html',
			async: false,
			cache: false,
			success: function (html) {
				$.cocoaStickerModal.open({
					forceLeft: isSidebarMini,
					target: btn,
					html: html,
					width: '240px',
					top: -28,
					left: isSidebarMini ? 48 : 32,
				});

				$('.cocoa-sticker-modal .modal-content').css('margin-left', '6px');
			}
		});
	};

	/**
	 * ì‡¼í•‘, ì˜ˆì•½ ë©”ë‰´ë¥¼ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ë¡œ ìˆ¨ê¹€/ë…¸ì¶œ ì²˜ë¦¬í•¨
	 * @param name
	 * @param is_show
	 */
	var toggleHiddenMenu = function(name, is_show){
		var $target = $('#main-menu').find('li[data-title=' + name + ']');
		if($target.length > 0){
			if(is_show){
				$target.addClass('animated');
				setTimeout(function(){
					$target.removeClass('animated-hidden');
					setTimeout(function(){
						$target.removeClass('animated');
					}, 200);
				}, 10);
			}else{
				if($target.hasClass('expanded')){
					// ë©”ë‰´ í™•ì¥ë˜ì—ˆì„ ë•Œ ë‹«ê³  ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
					$target.find('> ul').stop().slideUp(170, function (){
						$target.removeClass('expanded').addClass('animated');
						setTimeout(function(){
							$target.addClass('animated-hidden');
						}, 10);
					});
				}else{
					$target.addClass('animated');
					setTimeout(function(){
						$target.addClass('animated-hidden');
					}, 10);
				}

			}
		}
	};

	return {
		'dashboard_init' : function(){
			dashboard_init();
		},
		'updateIsDashboardFirstEnter' : function(){
			updateIsDashboardFirstEnter();
		},
		'giveAdminPermission' : function(){
			giveAdminPermission();
		},
		'getNoticeList' : function(list_body_obj){
			getNoticeList(list_body_obj);
		},
		'getActivityList' : function(list_body_obj){
			getActivityList(list_body_obj);
		},
		'moveTopMemo' : function(memo_idx){
			moveTopMemo(memo_idx);
		},
		'releaseTopMemo' : function(memo_idx){
			releaseTopMemo(memo_idx);
		},
		'showUpdateMemoForm' : function(memo_idx){
			showUpdateMemoForm(memo_idx);
		},
		'hideUpdateMemoForm' : function(memo_idx){
			hideUpdateMemoForm(memo_idx);
		},
		'deleteMemo' : function(memo_idx){
			deleteMemo(memo_idx);
		},
		'addMemo' : function($obj){
			addMemo($obj);
		},
		'openSiteManagementDialog' : function(btn){
			openSiteManagementDialog(btn);
		},
		'toggleHiddenMenu': function(name, is_show){
			toggleHiddenMenu(name, is_show);
		},
	};
})();